---
// Get current path for active navigation highlighting
const currentPath = Astro.url.pathname;
---

<header class="site-header header-visible">
  <div class="container">
    <nav class="main-nav" aria-label="Main Navigation">
      <a href="/" class="logo" aria-label="How to Fund Travel Home">
        <img src="/images/how-to-fund-travel-logo-transparent.svg" alt="How to Fund Travel Logo" width="450" height="96" loading="eager">
      </a>
      
      <button class="mobile-menu-toggle" aria-label="Toggle Menu" aria-expanded="false">
        Menu
      </button>
      
      <ul class="nav-links">
        <li><a href="/" class={currentPath === '/' ? 'active' : ''}>Home</a></li>
        <li><a href="/blog/" class={currentPath.startsWith('/blog') ? 'active' : ''}>Blog</a></li>
        <li><a href="/case-studies/" class={currentPath.startsWith('/case-studies') ? 'active' : ''}>Case Studies</a></li>
        <li><a href="/about" class={currentPath === '/about' ? 'active' : ''}>About Me</a></li>
      </ul>
      
      <div class="header-actions">
        <a href="/book-a-call" class="btn btn-primary book-call-btn">Book a Call</a>
      </div>
    </nav>
  </div>
</header>

<!-- Mobile menu backdrop -->
<div class="mobile-menu-backdrop" aria-hidden="true"></div>

<style>
/* Header specific styles */
.mobile-menu-toggle {
  display: none;
  background-color: var(--primary-color);
  color: white;
  border: none;
  border-radius: 4px;
  padding: 8px 16px;
  cursor: pointer;
  font-weight: bold;
  z-index: 1000;
}

@media (max-width: 768px) {
  .site-header {
    padding: 10px 0;
  }
  
  .main-nav {
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }
  
  .logo img {
    height: 60px;
    width: auto;
  }
  
  .mobile-menu-toggle {
    display: block;
  }
  
  .nav-links {
    display: none;
    flex-direction: column;
    width: 100%;
    text-align: center;
    gap: 10px;
  }
  
  .nav-links.nav-open {
    display: flex;
  }
  
  .header-actions {
    display: none;
    width: 100%;
    justify-content: center;
  }
  
  .header-actions.show-mobile {
    display: flex;
  }
}
</style>

<script>
  // Enhanced mobile menu functionality
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const navLinks = document.querySelector('.nav-links');
    const backdrop = document.querySelector('.mobile-menu-backdrop');
    const body = document.body;
    const headerActions = document.querySelector('.header-actions');
    
    // Function to open mobile menu
    function openMobileMenu() {
      mobileMenuToggle?.setAttribute('aria-expanded', 'true');
      navLinks?.classList.add('nav-open');
      headerActions?.classList.add('show-mobile');
      mobileMenuToggle?.classList.add('active');
      backdrop?.classList.add('active');
      body.classList.add('nav-open');
    }
    
    // Function to close mobile menu
    function closeMobileMenu() {
      mobileMenuToggle?.setAttribute('aria-expanded', 'false');
      navLinks?.classList.remove('nav-open');
      headerActions?.classList.remove('show-mobile');
      mobileMenuToggle?.classList.remove('active');
      backdrop?.classList.remove('active');
      body.classList.remove('nav-open');
    }
    
    // Toggle mobile menu
    if (mobileMenuToggle && navLinks) {
      mobileMenuToggle.addEventListener('click', function(e) {
        e.preventDefault();
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          closeMobileMenu();
        } else {
          openMobileMenu();
        }
      });
    }
    
    // Close menu when clicking backdrop
    backdrop?.addEventListener('click', closeMobileMenu);
    
    // Close menu on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && navLinks?.classList.contains('nav-open')) {
        closeMobileMenu();
      }
    });
    
    // Close menu when clicking on a link
    navLinks?.addEventListener('click', function(e) {
      if (e.target.tagName === 'A') {
        // Small delay to allow for smooth transition
        setTimeout(closeMobileMenu, 100);
      }
    });
    
    // Close menu on window resize (if switching to desktop)
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768 && navLinks?.classList.contains('nav-open')) {
        closeMobileMenu();
      }
    });
  });
</script>
